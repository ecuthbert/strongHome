version: '3'
services:
  openldap:
    build: ldap
    container_name: openldap
    command: --loglevel debug
    environment:
      LDAP_ORGANISATION: "strongHome"
      LDAP_DOMAIN: "${LOCAL_DOMAIN}"
      LDAP_ADMIN_PASSWORD: "admin"
      HOSTNAME: ldap.${LOCAL_DOMAIN}
    volumes:
      - $PWD/config/strongHome-schema.yaml:/strongHome/strongHome-schema.yaml
      - $PWD/config/strongHome-config-example.yaml:/strongHome/strongHome-config.yaml
      # - $PWD/ldap/ldap:/var/lib/ldap
      # - $PWD/ldap/slapd:/etc/ldap/slapd.d
      # - $PWD/openssl-ca:/container/service/slapd/assets/certs/
    ports:
      - "389:389"
    domainname: "${LOCAL_DOMAIN}" # important: same as hostname
    hostname: "ldap"
    networks:
      - ldap-net
      - radius-net

  freeradius:
    build: radius
    command: -XX
    # volumes:
    #   # - $PWD/radius/conf/clients.conf:/etc/raddb/clients.conf
    #   - $PWD/radius/conf/users:/etc/raddb/mods-config/files/authorize
    #   - $PWD/radius/conf/sites-available/default:/etc/raddb/sites-available/default
    #   - $PWD/radius/conf/sites-available/inner-tunnel:/etc/raddb/sites-available/inner-tunnel
    #   - $PWD/radius/conf/mods-available/ldap:/etc/raddb/mods-enabled/ldap
    depends_on:
      - openldap
    ports:
      - "1812-1813:1812-1813/udp"
    networks:
      - radius-net

  # webldap:
  #   image: osixia/phpldapadmin:0.8.0
  #   environment:
  #     PHPLDAPADMIN_LDAP_HOSTS: openldap
  #   ports:
  #     - "443:443"
  #     - "80:80"
  #   networks:
  #     - ldap-net

networks:
  ldap-net:
  radius-net:
